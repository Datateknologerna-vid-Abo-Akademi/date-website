{% extends 'base.html' %}

{% load app_filters %}
{% load static %}
    {% block content %}
<head>
    <link rel="stylesheet" href="{% static 'archive/css/style.css' %}" type="text/css">
    <link rel="script" href="{% static 'archive/js/scripts.js' %}">
</head>
    <div class="container">

        <h1 class="page-title">{{ collection.title }}</h1>
        <p>Published on {{ collection.pub_date_pretty }}</p>
        <p><a href="{% url 'archive:pictures' %}" class="button">Return</a>
            {% if request.user|in_group:"fotograf" or request.user|in_group:"styrelse"%}
            <a class="button" href="{% url 'archive:edit' collection.id %}">edit</a></p>
            {% endif %}
        {% if error_msg %}
            <p>{{ error_msg }}</p>
        {% endif %}

        <div class="picture-frame">
        <div class="column-frame">
        {% for picture in collection.picture_set.all %}
            <div class="img-container">
                <img id="picture-{{ forloop.counter }}" onclick="imageClick({{ forloop.counter }})" src="{{ picture.image.url }}" class="smaller-img">
            </div>
            {% if forloop.counter|arrangePictures:collection.picture_set.count %}
                </div><div class="column-frame">
            {% endif %}
            {% empty %}
            <h3>No {{ collection.type }} to show.</h3>
        {% endfor %}
            </div>
        </div>


        <script>
            function imageClick(id) {
               let element = document.getElementById("picture-" + id);
               console.log("ID: " + id);
               element.classList.toggle("enlarge");
               element.classList.toggle("smaller-img");
            }

            document.addEventListener("keydown", cycleEnlargedImage, true);

            function cycleEnlargedImage(e) {
                let keyCode = e.keyCode;
                if(keyCode === 37){
                    console.log("Left arrow pressed");
                    let element = document.getElementsByClassName("enlarge")[0];
                    if (element){
                        let element_id = element.id.split("-")[1];
                        console.log(element_id);
                        if( element_id > 1){
                            imageClick(element_id);
                            imageClick(parseInt(element_id)-1);
                        }
                    }
                }
                else if(keyCode === 39){
                    console.log("Right arrow pressed");
                    let element = document.getElementsByClassName("enlarge")[0];
                    if (element){
                        let element_id = element.id.split("-")[1];
                        if( element_id <= document.getElementsByClassName("smaller-img").length){
                            imageClick(element_id);
                            imageClick(parseInt(element_id)+1);
                        }
                    }
                }
            }
        </script>
    {% endblock %}
